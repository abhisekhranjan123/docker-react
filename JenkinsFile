node {
 

    def buildNumber=BUILD_NUMBER
        stage("Cloning The Git Repo")
        {
        git branch: 'main', credentialsId: 'Handsek_GIT_Jenkins', url: 'https://github.com/abhisekhranjan123/docker-react.git'   
        }
        stage("Code Quality Review")
            {
                
                    echo "Ok"
               
            }  
       stage("Building Docker Image Of Application") 
        {
        
        sh "docker build -t abhisekhranjan123/docker-react:${buildNumber} ."
        }
    
        stage("Docker Image Of Application Pushing to the DockerHub") 
        {
            withCredentials([string(credentialsId: 'Docker_Hub_Pwd', variable: 'Docker_Hub_Pwd')])
                {
                     sh "docker login -u abhisekhranjan123 -p ${Docker_Hub_Pwd}"
                }
             sh "docker push abhisekhranjan123/docker-react:${buildNumber}"
        }
           stage("Making Apllication Live On Web Server "){
                 sshagent(['DOCKER_SERVER'])
                 {
                      sh "ssh -o StrictHostKeyChecking=no ubuntu@172.31.13.234 docker rm -f docker-react || true"
                     sh "ssh -o StrictHostKeyChecking=no ubuntu@172.31.13.234 docker run -d -p 80:80 --name docker-react abhisekhranjan123/docker-react:${buildNumber}"
                }

}
}
